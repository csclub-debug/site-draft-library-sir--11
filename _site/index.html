<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Sir M V Government Science College</title>
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>
  <!-- Navbar -->
  <div class="navbar-wrap">
    <div class="navbar" role="navigation" aria-label="Main">
        <div class="brand"><img class="logo" src="logo.svg" alt="logo"><div><div class="title">Sir M V Science College</div><div style="font-size:12px;color:var(--muted)">Library & Informatics Centre</div></div></div>
        <button class="hamburger" aria-label="Open menu">☰</button>
        <div class="nav" role="menubar">
            <a href="index.html">Home</a>
            <a href="about.html">About</a>
            <a href="question-papers.html">Question Papers</a>
            <a href="staff.html">Staff</a>
            <a href="announcements.html">Announcements</a>
            <a href="contact.html">Contact</a>
        </div>
    </div>
</div>
<div class="drawer-backdrop" aria-hidden="true"></div>
<div class="drawer" aria-hidden="true">
    <div class="drawer-menu">
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a href="question-papers.html">Question Papers</a>
        <a href="staff.html">Staff</a>
        <a href="announcements.html">Announcements</a>
        <a href="contact.html">Contact</a>
        <div style="margin-top:12px"><a class="email-btn" href="mailto:sirmvsciencebdvt@gmail.com">Email: sirmvsciencebdvt@gmail.com</a></div>
    </div>
</div>

  <!-- Spacer for sticky header -->
  <div class="header-spacer"></div>

  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-inner container">
      <div class="hero-media">
        <img src="campus-hero.jpg" alt="College Campus">
      </div>
      <div class="hero-card hero-cta">
        <h1>SIR M V GOVERNMENT SCIENCE COLLEGE</h1>
        <p>Bommanakatte, Bhadravathi</p>

        <div class="search-box" style="margin-top:8px; position:relative;">
          <input id="searchBox" placeholder="Search books, notes or past papers" aria-label="Search books and question papers">
          <button id="searchBtn">Search</button>

          <!-- suggestions container (populated by JS) -->
          <div id="searchSuggestions" class="search-suggestions" aria-hidden="true" style="display:none"></div>
        </div>

        <div class="stats-grid">
          <div class="stat">
            <div class="num">20,900+</div>
            <div class="label">Total Books</div>
          </div>
          <div class="stat">
            <div class="num">1976</div>
            <div class="label">Established</div>
          </div>
          <div class="stat">
            <div class="num">13-01-1999</div>
            <div class="label">UGC Recognition</div>
          </div>
          <div class="stat">
            <div class="num">Kuvempu University</div>
            <div class="label">Affiliation</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- About Section -->
  <section class="about">
    <div class="about-wrapper container">
      <!-- Image Above -->
      <div class="about-image">
        <img src="college.jpg" alt="Sir M V Government Science College Campus">
      </div>

      <!-- Info Below -->
      <div class="info">
        <h3>About the Institution</h3>
        <dl>
          <dt>Name of the Institution :</dt>
          <dd>SIR M V GOVERNMENT SCIENCE COLLEGE</dd>
          <dt>Address :</dt>
          <dd>Bommanakatte, Bhadravathi - 577302</dd>
          <dt>Tel No. :</dt>
          <dd>212173314</dd>
          <dt>E-mail :</dt>
          <dd>sirmvlibrarybdvt@gmail.com</dd>
          <dt>Year of establishment :</dt>
          <dd>01-06-1976</dd>
          <dt>Date of recognition by UGC :</dt>
          <dd>(2f)-f-8-1/92/(CPP-1) Aug-92 12B-13-01-1999</dd>
          <dt>Nature of the Institution :</dt>
          <dd>Affiliated to Kuvempu University</dd>
        </dl>
      </div>
    </div>
  </section>

  <!-- About Section Styles -->
  <style>
    .about {
      padding: 40px 0;
    }
    .about-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 24px;
      max-width: 1100px; /* aligned with other containers */
      margin: 0 auto;
    }
    .about-image {
      width: 100%;
    }
    .about-image img {
      width: 100%;
      height: auto;
      max-height: 420px;
      object-fit: cover;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .info {
      width: 100%;
      background: #fff;
      padding: 28px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .info dl {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 16px;
    }
    .info dt {
      font-weight: 700;
      color: #333;
    }
    .info dd {
      margin: 0;
      color: #555;
    }
    @media (max-width: 768px) {
      .info dl {
        grid-template-columns: 1fr;
      }
      .about-image img {
        max-height: 320px;
      }
      .about-wrapper {
        padding: 0 16px;
      }
    }
  </style>

  <!-- Library Services Section -->
  <section class="section container">
    <h2>Library Services</h2>
    <div class="cards">
      <a class="card" href="opac.html">
        <strong>OPAC</strong>
        <p>Search our catalog and find books quickly.</p>
      </a>
      <a class="card" href="e-resources.html">
        <strong>E-Resources</strong>
        <p>Access e-books, journals and online databases.</p>
      </a>
      <a class="card" href="researchpage.html">
        <strong>Research Support</strong>
        <p>Get research help and citation assistance.</p>
      </a>
    </div>
  </section>

  <!-- Announcements Section (dynamically populated) -->
  <section class="accordion container">
    <h2>Latest Announcements</h2>
    <div id="announcementsContainer">
      <!-- JS will render the latest 3 announcements here (falls back to static list if JSON missing) -->
      <div class="acc-item">
        <div class="acc-header">Loading announcements…</div>
      </div>
    </div>
  </section>

  <!-- Footer -->
 <div class="footer-pad"></div>

  <footer class="site-footer" role="contentinfo">
    <div class="inner">
      <div style="display:flex;gap:12px;align-items:center">
        <img src="logo.svg" alt="logo" style="height:44px;width:44px;border-radius:8px">
        <div>
          <div style="font-weight:700">Sir M V Science College Library</div>
          <div style="font-size:13px;color:#9aa4b2">Library & Informatics Centre</div>
        </div>
      </div>

      <div style="color:#9aa4b2;font-size:14px">Sir. M.V. Government Science College, Bommanakatte, Bhadravathi - 577302</div>

      <div style="display:flex;gap:12px;align-items:center">
        <a class="social-btn fb" href="" target="_blank" aria-label="Facebook">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M22 12.07C22 6.48 17.52 2 11.93 2S2 6.48 2 12.07C2 17.09 5.64 21.26 10.36 22v-7.02H7.9v-2.92h2.46v-2.22c0-2.44 1.46-3.79 3.6-3.79 1.04 0 2.12.18 2.12.18v2.33h-1.19c-1.17 0-1.54.73-1.54 1.48v1.98h2.62l-.42 2.92h-2.2V22C18.36 21.26 22 17.09 22 12.07z" fill="white"/></svg>
        </a>

        <a class="social-btn ig" href="" target="_blank" aria-label="Instagram">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M7 2h10a5 5 0 015 5v10a5 5 0 01-5 5H7a5 5 0 01-5-5V7a5 5 0 015-5zm5 6.5a4.5 4.5 0 100 9 4.5 4.5 0 000-9zm6.5-.5a1 1 0 11-2 0 1 1 0 012 0z" fill="white"/></svg>
        </a>

        <a class="social-btn tw" href="" target="_blank" aria-label="Twitter">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M22 5.92c-.63.28-1.3.47-2.01.56.72-.43 1.27-1.12 1.53-1.94-.68.4-1.43.7-2.23.86A3.49 3.49 0 0016.5 4c-1.93 0-3.5 1.6-3.5 3.57 0 .28.03.55.09.81-2.91-.15-5.49-1.58-7.21-3.75-.3.5-.47 1.08-.47 1.69 0 1.16.61 2.19 1.54 2.79-.56-.02-1.09-.18-1.55-.42v.04c0 1.64 1.15 3.01 2.67 3.33-.28.07-.58.11-.88.11-.21 0-.42-.02-.62-.06.42 1.31 1.66 2.26 3.13 2.29A6.98 6.98 0 012 19.54a9.8 9.8 0 005.29 1.56c6.35 0 9.83-5.6 9.83-10.46v-.48c.68-.5 1.27-1.12 1.74-1.83-.63.28-1.3.47-2.01.56z" fill="white"/></svg>
        </a>

        <a class="email-btn" href="mailto:" aria-label="Email">Email Us</a>
      </div>
    </div>
  </footer>

  <script src="assets/main.js"></script>

  <!-- Minimal styles for suggestions + tidy accordion behavior (very small & safe) -->
  <style>
    .search-suggestions {
      position: absolute;
      left: 0;
      right: 0;
      top: calc(100% + 6px);
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(15,20,30,0.06);
      max-height: 320px;
      overflow: auto;
      z-index: 60;
      display: none;
    }
    .search-suggestions .suggestion {
      padding: 10px 14px;
      border-bottom: 1px solid rgba(0,0,0,0.04);
      cursor: pointer;
    }
    .search-suggestions .suggestion:hover,
    .search-suggestions .suggestion:focus {
      background: rgba(0,0,0,0.03);
    }
    .acc-item .acc-header {
      cursor: pointer;
      user-select: none;
    }
    .acc-item .acc-body {
      padding: 12px 16px;
      background: #fff;
      border-radius: 8px;
      margin-top: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
    }
  </style>

  <!-- Script: dynamically load announcements, build live search (books + qpapers),
       and render auto-suggestions while typing. -->
  <script>
  (function () {
    const searchBox = document.getElementById('searchBox');
    const searchBtn = document.getElementById('searchBtn');
    const suggestionsEl = document.getElementById('searchSuggestions');
    const announcementsContainer = document.getElementById('announcementsContainer');

    let dataJson = null;
    let booksIndex = [];
    let papersIndex = [];

    // Helper: safe fetch JSON (returns null on error)
    async function fetchJson(path) {
      try {
        const res = await fetch(path, { cache: 'no-cache' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        return await res.json();
      } catch (err) {
        return null;
      }
    }

    // Normalize and collect items from the data sources
    function collectBooksFromData(d) {
      const list = [];
      if (!d) return list;
      // highlights in content/data.json
      if (Array.isArray(d.books)) {
        d.books.forEach(b => {
          list.push({
            title: b.title || '',
            author: b.author || '',
            type: 'Book',
            source: 'data',
            raw: b,
            url: b.url || b.link || null
          });
        });
      }
      return list;
    }

    function collectBooksFromCatalog(catalogJson) {
      const list = [];
      if (!catalogJson) return list;
      // config suggests content/books.json with { "books": [ ... ] }
      if (Array.isArray(catalogJson.books)) {
        catalogJson.books.forEach(b => {
          list.push({
            title: b.title || '',
            author: b.author || '',
            accession_no: b.accession_no || '',
            type: 'Book',
            source: 'catalog',
            raw: b,
            url: b.url || b.link || null
          });
        });
      }
      return list;
    }

    function collectPapersFromQpapers(qp) {
      const list = [];
      if (!qp) return list;
      // qpapers.json per admin: { "departments": [ { department, papers: [ {title, link} ] } ] }
      if (Array.isArray(qp.departments)) {
        qp.departments.forEach(dept => {
          (dept.papers || []).forEach(p => {
            list.push({
              title: p.title || '',
              department: dept.department || '',
              link: p.link || null,
              type: 'Question Paper',
              source: 'qpapers',
              raw: p
            });
          });
        });
      }
      return list;
    }

    // Render announcements (latest 3)
    function renderAnnouncements() {
      if (!announcementsContainer) return;
      announcementsContainer.innerHTML = '';
      const anns = Array.isArray(dataJson?.announcements) ? dataJson.announcements.slice() : [];

      if (!anns.length) {
        // fallback: preserve original static content if JSON missing
        announcementsContainer.innerHTML = `
          <div class="acc-item">
            <div class="acc-header">Library Orientation +</div>
            <div class="acc-body">New students can attend orientation on October 5th.</div>
          </div>
          <div class="acc-item">
            <div class="acc-header">E-Resource Update +</div>
            <div class="acc-body">Access new research journals added in September.</div>
          </div>
          <div class="acc-item">
            <div class="acc-header">Holiday Notice +</div>
            <div class="acc-body">The library will remain closed on Gandhi Jayanti.</div>
          </div>
        `;
        attachAccordionHandlers();
        return;
      }

      // Sort by date (newest first) and keep top 3
      anns.sort((a, b) => new Date(b.date || b.published || 0) - new Date(a.date || a.published || 0));
      anns.slice(0, 3).forEach(item => {
        const acc = document.createElement('div');
        acc.className = 'acc-item';

        const header = document.createElement('div');
        header.className = 'acc-header';
        header.tabIndex = 0;
        header.setAttribute('role', 'button');
        header.innerHTML = (item.title || 'Announcement') + ' <span class="acc-plus">+</span>';

        const body = document.createElement('div');
        body.className = 'acc-body';
        body.style.display = 'none';
        body.textContent = item.body || item.note || '';

        header.addEventListener('click', () => {
          body.style.display = body.style.display === 'none' ? 'block' : 'none';
        });
        header.addEventListener('keypress', (e) => { if (e.key === 'Enter') header.click(); });

        acc.appendChild(header);
        acc.appendChild(body);
        announcementsContainer.appendChild(acc);
      });
    }

    // Attach handlers to any existing accordion items (fallback)
    function attachAccordionHandlers() {
      document.querySelectorAll('.acc-item .acc-header').forEach(h => {
        const body = h.nextElementSibling;
        if (body) body.style.display = 'none';
        h.tabIndex = 0;
        h.addEventListener('click', () => {
          if (body) body.style.display = body.style.display === 'none' ? 'block' : 'none';
        });
        h.addEventListener('keypress', e => { if (e.key === 'Enter') h.click(); });
      });
    }

    // Build suggestions from query
    function updateSuggestions(rawQuery) {
      const q = String(rawQuery || '').trim().toLowerCase();
      if (!suggestionsEl) return;
      suggestionsEl.innerHTML = '';
      if (!q) {
        suggestionsEl.style.display = 'none';
        suggestionsEl.setAttribute('aria-hidden', 'true');
        return;
      }

      const bookMatches = booksIndex.filter(b => {
        return (b.title && b.title.toLowerCase().includes(q)) ||
               (b.author && b.author.toLowerCase().includes(q)) ||
               (b.accession_no && b.accession_no.toLowerCase().includes(q));
      }).map(b => Object.assign({}, b, { display: b.title + (b.author ? ' — ' + b.author : '') }));

      const paperMatches = papersIndex.filter(p => {
        return (p.title && p.title.toLowerCase().includes(q)) ||
               (p.department && p.department.toLowerCase().includes(q));
      }).map(p => Object.assign({}, p, { display: p.title + (p.department ? ' — ' + p.department : '') }));

      const matches = bookMatches.concat(paperMatches).slice(0, 8);

      if (!matches.length) {
        const none = document.createElement('div');
        none.className = 'suggestion';
        none.textContent = 'No results';
        suggestionsEl.appendChild(none);
        suggestionsEl.style.display = 'block';
        suggestionsEl.setAttribute('aria-hidden', 'false');
        return;
      }

      const frag = document.createDocumentFragment();
      matches.forEach(m => {
        const el = document.createElement('div');
        el.className = 'suggestion';
        el.tabIndex = 0;
        const typeLabel = m.type ? ` (${m.type})` : '';
        el.innerHTML = `<strong>${escapeHtml(m.title || m.display || '')}</strong><small style="opacity:.7">${escapeHtml(typeLabel)}</small>`;
        el.addEventListener('click', () => openItem(m));
        el.addEventListener('keypress', e => { if (e.key === 'Enter') openItem(m); });
        frag.appendChild(el);
      });
      suggestionsEl.appendChild(frag);
      suggestionsEl.style.display = 'block';
      suggestionsEl.setAttribute('aria-hidden', 'false');
    }

    function openItem(item) {
      // prefer explicit link
      if (item.link) {
        // open qpaper link in new tab
        window.open(item.link, '_blank');
        return;
      }
      if (item.url) {
        // open direct url if present
        window.location.href = item.url;
        return;
      }
      // fallback: navigate to relevant listing pages with query
      if (item.type === 'Question Paper' || item.source === 'qpapers') {
        window.location.href = 'question-papers.html';
        return;
      }
      // for books fallback to OPAC with query
      const q = encodeURIComponent(item.title || '');
      window.location.href = 'opac.html?q=' + q;
    }

    // Simple escape for text inserted into HTML
    function escapeHtml(str) {
      return String(str || '').replace(/[&<>"']/g, function (m) {
        return { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m];
      });
    }

    // Debounce input
    let debounceTimer = null;
    if (searchBox) {
      searchBox.addEventListener('input', (e) => {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => updateSuggestions(e.target.value), 160);
      });
    }

    // Search button: navigate to first match or show search listing fallback
    if (searchBtn) {
      searchBtn.addEventListener('click', () => {
        const q = (searchBox && searchBox.value || '').trim().toLowerCase();
        if (!q) { alert('Please type something to search.'); return; }
        const firstBook = booksIndex.find(b => (b.title && b.title.toLowerCase().includes(q)) || (b.author && b.author.toLowerCase().includes(q)));
        if (firstBook) { openItem(firstBook); return; }
        const firstPaper = papersIndex.find(p => p.title && p.title.toLowerCase().includes(q));
        if (firstPaper) { openItem(firstPaper); return; }
        // no direct match — redirect to search pages as a fallback:
        window.location.href = 'opac.html?q=' + encodeURIComponent(searchBox.value.trim());
      });
    }

    // Hide suggestions when clicking outside search-box
    document.addEventListener('click', (e) => {
      const wrapper = document.querySelector('.search-box');
      if (!wrapper) return;
      if (!wrapper.contains(e.target)) {
        if (suggestionsEl) {
          suggestionsEl.style.display = 'none';
          suggestionsEl.setAttribute('aria-hidden', 'true');
        }
      }
    });

    // Initialize: load JSONs and build index, then render announcements
    (async function init() {
      dataJson = await fetchJson('content/data.json');
      const catalogJson = await fetchJson('content/books.json');
      const qpapersJson = await fetchJson('content/qpapers.json');

      // collect books from both places (highlights + catalog)
      booksIndex = collectBooksFromData(dataJson).concat(collectBooksFromCatalog(catalogJson || {}));

      // collect question papers
      papersIndex = collectPapersFromQpapers(qpapersJson || {});

      // render announcements (latest 3)
      renderAnnouncements();

      // attach accordion handlers for any pre-existing static items too
      attachAccordionHandlers();
    })();
  })();
  </script>
</body>
</html>
